# Deploy to Cloud Run using buildpacks
  gcloud run deploy gcp-sm-ingest \
    --source . \
    --platform managed \
    --region us-central1 \
    --service-account cloudrun-storage-processor@max-sm-ingest-dev.iam.gserviceaccount.com \
    --allow-unauthenticated 

#authenticate to GCP
gcloud auth login
gcloud config get project
gcloud config set project max-sm-ingest-dev

gcloud projects add-iam-policy-binding $(gcloud config
  get-value project) \
      --member="serviceAccount:service-306554071669@gs-project-accounts.iam.gserviceaccount.com" \
      --role="roles/pubsub.publisher"

Typical Service Account Organization
  - Cloud Run services: One SA per service or group of
  related services
  - Batch jobs: Dedicated SA with specific permissions
  - CI/CD: Separate SA for deployment operations
  - Data processing: SA with only storage/database
  permissions needed


gcloud eventarc triggers create gcp-sm-ingest-trigger \
      --destination-run-service=gcp-sm-ingest \
      --destination-run-region=us-central1 \
      --destination-run-path=/storage-event \
      --location=us-central1 \
      --event-filters="type=google.cloud.storage.object.v1.finalized" \
      --event-filters="bucket=sm-ingest-dev-8" \
      --service-account=cloudrun-storage-processor@max-sm-ingest-dev.iam.gserviceaccount.com

cloud run services describe gcp-sm-ingest --region=us-central1 --format=json
gcloud artifacts repositories list --repository-format=docker --project="max-sm-ingest-dev"

gcloud builds submit --tag "us-central1-docker.pkg.dev/$GCP_PROJECT/cloud-run-source-deploy/$JOB_NAME:latest" .
gcloud builds submit --tag "us-central1-docker.pkg.dev/max-sm-ingest-dev/cloud-run-source-deploy/etl-processor:latest"


gcloud builds submit --tag "us-central1-docker.pkg.dev/addv1-td-alldata-app/cloud-run-source-deploy/etl-processor:latest"

gcloud auth list
gcloud config get-value project, account
gcloud config set account `ACCOUNT`

gcloud --impersonate-service-account="<SA_EMAIL>" builds submit --tag "us-central1-docker.pkg.dev/addv1-td-alldata-app/cloud-run-source-deploy/$env:etl-processor:latest"



